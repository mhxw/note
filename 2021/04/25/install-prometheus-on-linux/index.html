<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Prometheus(普罗米修斯)+Grafana+Node Export实现服务器性能监控 | MHXW</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/note/logo.png">
    <link rel="alternate" type="application/rss+xml" href="https://mhxw.life/rss.xml" title="MHXW RSS Feed">
    <meta name="description" content="

Prometheus是一个开放性的监控解决方案，用户可以非常方便的安装和使用Prometheus并且能够非常方便的对其进行扩展。为了能够更加直观的了解Prometheus Server，接下来我们将在本地部署并运行一个Prometheus Server实例，通过Node Exporter采集当前主机的系统资源使用情况。 并通过Grafana创建一个简单的可视化仪表盘。

一、基础环境
 ...">
    <meta name="MHXW" content="mhxw blog">
    
    <link rel="preload" href="/note/assets/css/0.styles.15d6f971.css" as="style"><link rel="preload" href="/note/assets/js/app.36252550.js" as="script"><link rel="preload" href="/note/assets/js/8.2b515bb1.js" as="script"><link rel="preload" href="/note/assets/js/3.f6739d14.js" as="script"><link rel="preload" href="/note/assets/js/5.e5967abf.js" as="script"><link rel="preload" href="/note/assets/js/11.103ea2f0.js" as="script"><link rel="prefetch" href="/note/assets/js/10.6929b2b7.js"><link rel="prefetch" href="/note/assets/js/12.4d636b7f.js"><link rel="prefetch" href="/note/assets/js/13.d93a6436.js"><link rel="prefetch" href="/note/assets/js/14.521720fc.js"><link rel="prefetch" href="/note/assets/js/15.fe7581b1.js"><link rel="prefetch" href="/note/assets/js/16.fd0d2525.js"><link rel="prefetch" href="/note/assets/js/17.bd669e5d.js"><link rel="prefetch" href="/note/assets/js/18.49681434.js"><link rel="prefetch" href="/note/assets/js/19.dff2ad59.js"><link rel="prefetch" href="/note/assets/js/20.97e79743.js"><link rel="prefetch" href="/note/assets/js/21.c93097bc.js"><link rel="prefetch" href="/note/assets/js/22.429da250.js"><link rel="prefetch" href="/note/assets/js/23.730f8451.js"><link rel="prefetch" href="/note/assets/js/24.6eed2fc2.js"><link rel="prefetch" href="/note/assets/js/25.6ccaca11.js"><link rel="prefetch" href="/note/assets/js/26.a22dd40f.js"><link rel="prefetch" href="/note/assets/js/27.78579ce9.js"><link rel="prefetch" href="/note/assets/js/28.b4036104.js"><link rel="prefetch" href="/note/assets/js/29.4aa3c2c4.js"><link rel="prefetch" href="/note/assets/js/30.3a3b493c.js"><link rel="prefetch" href="/note/assets/js/31.57fab91c.js"><link rel="prefetch" href="/note/assets/js/32.47a51bf2.js"><link rel="prefetch" href="/note/assets/js/33.13e1708f.js"><link rel="prefetch" href="/note/assets/js/34.2b92be19.js"><link rel="prefetch" href="/note/assets/js/35.3536a88d.js"><link rel="prefetch" href="/note/assets/js/36.1c3e47e9.js"><link rel="prefetch" href="/note/assets/js/4.638b10e5.js"><link rel="prefetch" href="/note/assets/js/6.c4877f48.js"><link rel="prefetch" href="/note/assets/js/7.e800e18b.js"><link rel="prefetch" href="/note/assets/js/9.632d5cc1.js"><link rel="prefetch" href="/note/assets/js/vuejs-paginate.92caeb0c.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.15d6f971.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/note/" class="nav-link home-link">MHXW </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/note/" class="nav-link">首页</a></li><li class="nav-item"><a href="/note/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="/note/about.html" class="nav-link">关于</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/note/" class="nav-link mobile-home-link">MHXW </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/note/" class="nav-link">首页</a></li><li class="mobile-nav-item"><a href="/note/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="/note/about.html" class="nav-link">关于</a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Prometheus(普罗米修斯)+Grafana+Node Export实现服务器性能监控
      </h1> <div class="post-meta"><div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-4-25">
        2021-04-25
      </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-450235f2><a href="/note/tag/prometheus" data-v-450235f2><span data-v-450235f2>prometheus</span></a></li><li class="post-tag" data-v-450235f2><a href="/note/tag/golang" data-v-450235f2><span data-v-450235f2>golang</span></a></li><li class="post-tag" data-v-450235f2><a href="/note/tag/grafana" data-v-450235f2><span data-v-450235f2>grafana</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>Prometheus是一个开放性的监控解决方案，用户可以非常方便的安装和使用Prometheus并且能够非常方便的对其进行扩展。为了能够更加直观的了解Prometheus Server，接下来我们将在本地部署并运行一个Prometheus Server实例，通过Node Exporter采集当前主机的系统资源使用情况。 并通过Grafana创建一个简单的可视化仪表盘。</p> <h2 id="一、基础环境"><a href="#一、基础环境" class="header-anchor">#</a> 一、基础环境</h2> <table><thead><tr><th>环境/组件</th> <th>版本</th></tr></thead> <tbody><tr><td>操作系统</td> <td>CentOS Linux release 7.6.1810</td></tr> <tr><td>Prometheus</td> <td>prometheus-2.22.1.linux-amd64.tar.gz</td></tr> <tr><td>go</td> <td>go1.15.4.linux-amd64.tar.gz</td></tr> <tr><td>Grafana</td> <td>grafana-7.3.3-1.x86_64.rpm</td></tr></tbody></table> <h2 id="二、安装go"><a href="#二、安装go" class="header-anchor">#</a> 二、安装Go</h2> <h3 id="_1、下载解压安装"><a href="#_1、下载解压安装" class="header-anchor">#</a> 1、下载解压安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>https://golang.org/dl/
</code></pre></div><p>使用以下命令golang文件会自动下载并解压到<code>/mhxw/go</code>到目录下</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> -c https://dl.google.com/go/go1.16.5.linux-amd64.tar.gz -O - <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tar</span> -xz -C /mhxw/
</code></pre></div><h3 id="_2、配置环境变量"><a href="#_2、配置环境变量" class="header-anchor">#</a> 2、配置环境变量</h3> <p>通过将 Go 目录添加到$PATH环境变量，系统将会知道在哪里可以找到 Go 可执行文件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> ~/.profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/mhxw/go/bin
</code></pre></div><p>保存文件，并且重新加载新的PATH 环境变量到当前的 shell 会话：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">source</span> ~/.profile
</code></pre></div><h3 id="_3、验证"><a href="#_3、验证" class="header-anchor">#</a> 3、验证</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>go version
</code></pre></div><h2 id="三、安装prometheus"><a href="#三、安装prometheus" class="header-anchor">#</a> 三、安装Prometheus</h2> <h3 id="_1、下载、解压、设置软连接"><a href="#_1、下载、解压、设置软连接" class="header-anchor">#</a> 1、下载、解压、设置软连接</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>https://prometheus.io/download/<span class="token comment">#prometheus</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://github.com/prometheus/prometheus/releases/download/v2.27.1/prometheus-2.27.1.linux-amd64.tar.gz
</code></pre></div><p><img src="/note/assets/img/pt-4.30a4ae70.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">tar</span> -xvf prometheus-2.27.1.linux-amd64.tar.gz
<span class="token function">mv</span> prometheus-2.27.1.linux-amd64 prometheus
</code></pre></div><h3 id="_2、启动"><a href="#_2、启动" class="header-anchor">#</a> 2、启动</h3> <p>普罗米修斯默认配置文件 <code>/mhxw/prometheus/prometheus/prometheus.yml</code></p> <ul><li>先修改prometheus配置文件</li></ul> <div class="language- extra-class"><pre class="language-text"><code>vim /mhxw/prometheus/prometheus/prometheus.yml
</code></pre></div><p>以下参数设置为1min</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  scrape_interval:     1m <span class="token comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span>
  evaluation_interval: 1m
  
  - job_name: <span class="token string">'prometheus'</span>

  <span class="token comment"># metrics_path defaults to '/metrics'</span>
  <span class="token comment"># scheme defaults to 'http'.</span>

  static_configs:
  - targets: <span class="token punctuation">[</span><span class="token string">'localhost:14200'</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>启动命令</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>./prometheus --config.file<span class="token operator">=</span>/mhxw/prometheus/prometheus/prometheus.yml --web.listen-address<span class="token operator">=</span>:14200
</code></pre></div><ul><li>进入会话</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>tmux a -t prom
</code></pre></div><ul><li>设置systemctl管理</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span> Prometheus
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token comment"># Type设置为notify时，服务会不断重启# User设置对应上面创建的账号</span>
<span class="token comment"># 存储配置, </span>
<span class="token comment"># By default, Prometheus stores its database in ./data (flag --storage.tsdb.path).</span>
<span class="token comment"># --storage.tsdb.path: 存储数据的目录，默认为./data</span>
<span class="token comment"># --storage.tsdb.retention.time: 数据过期清理时间，默认保存15天</span>
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
<span class="token assign-left variable">User</span><span class="token operator">=</span>root
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/Prometheus/prometheus --config.file<span class="token operator">=</span>/usr/local/Prometheus/prometheus.yml --storage.tsdb.path<span class="token operator">=</span>/usr/local/Prometheus/data
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill -HUP <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre></div><ul><li>启动参数解释</li></ul> <div class="language- extra-class"><pre class="language-text"><code>–config.file=/etc/prometheus.yml 指定配置文件
  
–web.read-timeout=5m 请求链接的最大等待时间，防止太多的空闲链接占用资源
  
–web.max-connections=512 针对prometheus，获取数据源的时候，建立的网络链接数，做一个最大数字的限制，防止链接数过多造成资源过大的消耗
  
–storage.tsdb.retention=15d 重要参数，prometheus 开始采集监控数据后，会存在内存和硬盘中；对于保存期限的设置。时间过长，硬盘和内存都吃不消；时间太短，要查历史数据就没了。企业15天最为合适。
  
–storage.tsdb.path=&quot;/prometheus/data&quot; 存储数据路径，不要随便定义
  
–query.max-concurrency=20 用户查询最大并发数
  
–query.timeout=2m 慢查询强制终止
</code></pre></div><blockquote><p>注意：
本次启动用户是root生产中最好新建一个用户用于启动，需要设置配置文件及数据文件权限
数据目录在生产中最好单独配置数据硬盘，使用LVM硬盘格式配置</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /usr/lib/systemd/system/prometheus.service
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> prometheus.service
systemctl start prometheus.service
systemctl status prometheus.service
</code></pre></div><h3 id="_3、验证-2"><a href="#_3、验证-2" class="header-anchor">#</a> 3、验证</h3> <p>浏览器打开<code>IP:9090</code>即可打开普罗米修斯自带的监控页面</p> <p><img src="/note/assets/img/pt-1.286b3d88.png" alt=""></p> <h2 id="四、安装grafana"><a href="#四、安装grafana" class="header-anchor">#</a> 四、安装Grafana</h2> <p>Grafana是一款用Go语言开发的开源数据可视化工具，可以做数据监控和数据统计，带有告警功能。</p> <h3 id="_1、打开官网并下载"><a href="#_1、打开官网并下载" class="header-anchor">#</a> 1、打开官网并下载</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>https://grafana.com/grafana/download
</code></pre></div><p><img src="/note/assets/img/pt-2.f6022b51.png" alt=""></p> <ul><li>找到对应版本和linux内核下载</li></ul> <p><img src="/note/assets/img/pt-3.f6022b51.png" alt=""></p> <h3 id="_2、安装"><a href="#_2、安装" class="header-anchor">#</a> 2、安装</h3> <ul><li>centos 方式</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://dl.grafana.com/oss/release/grafana-7.5.7-1.x86_64.rpm
<span class="token function">sudo</span> yum <span class="token function">install</span> grafana-7.5.7-1.x86_64.rpm
</code></pre></div><ul><li>ubuntu方式</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://dl.grafana.com/oss/release/grafana-8.0.0.linux-amd64.tar.gz
<span class="token function">tar</span> -zxvf grafana-8.0.0.linux-amd64.tar.gz
<span class="token function">mv</span> /mhxw/prometheus/grafana-8.0.0 /mhxw/prometheus/grafana
</code></pre></div><p>设置端口和IP</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /mhxw/prometheus/grafana/conf/defaults.ini
</code></pre></div><p>设置端口和IP</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># The http port to use</span>
http_port <span class="token operator">=</span> <span class="token number">14201</span>

<span class="token comment"># The public facing domain name used to access grafana from a browser</span>
domain <span class="token operator">=</span> <span class="token number">0.0</span>.0.0

</code></pre></div><h3 id="_3、启动"><a href="#_3、启动" class="header-anchor">#</a> 3、启动</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>tmux new -s grafana
</code></pre></div><ul><li>进入会话</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>tmux a -t grafana
 /mhxw/prometheus/grafana/bin/grafana-server --config /mhxw/prometheus/grafana/conf/defaults.ini
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>/bin/systemctl daemon-reload
/bin/systemctl <span class="token builtin class-name">enable</span> grafana-server.service
/bin/systemctl start grafana-server.service
</code></pre></div><h3 id="_4、访问grafana"><a href="#_4、访问grafana" class="header-anchor">#</a> 4、访问Grafana</h3> <p>浏览器访问<code>IP:3000</code>端口，即可打开grafana页面，默认用户名密码都是admin，初次登录会要求修改默认的登录密码</p> <p><img src="/note/assets/img/pt-5.81acfb25.png" alt="登录页面"></p> <p>进入后的面板</p> <p><img src="/note/assets/img/pt-6.48cdb646.png" alt="进入后的页面"></p> <h3 id="_5、与-prometheus-交互"><a href="#_5、与-prometheus-交互" class="header-anchor">#</a> 5、与 Prometheus 交互</h3> <ul><li>点击 Data Sources</li></ul> <p><img src="/note/assets/img/pt-7.ffaca6ad.png" alt="点击 Data Sources"></p> <ul><li>Add Data Sources</li></ul> <p><img src="/note/assets/img/pt-8.27ddb96d.png" alt="Add Data Sources"></p> <ul><li>选择“Prometheus 2.0 Stats”</li></ul> <p><img src="/note/assets/img/pt-9.870045b3.png" alt="Select"></p> <ul><li>点击“import”按钮导入</li></ul> <p><img src="/note/assets/img/pt-10.0a745aad.png" alt=""></p> <p><img src="/note/assets/img/pt-11.56100dcb.png" alt=""></p> <ul><li>在Settings页面填写之前的普罗米修斯<code>URL</code>并点击保存</li></ul> <p><img src="/note/assets/img/pt-12.9317819a.png" alt=""></p> <ul><li>切换到刚才添加的“Prometheus 2.0 Stats”即可看到整个监控页面</li></ul> <p><img src="/note/assets/img/pt-13.f5c01ac0.png" alt=""></p> <p><img src="/note/assets/img/pt-14.175ebfca.png" alt=""></p> <h2 id="五、配置-node-exporter"><a href="#五、配置-node-exporter" class="header-anchor">#</a> 五、配置 Node_Exporter</h2> <h3 id="_1、下载"><a href="#_1、下载" class="header-anchor">#</a> 1、下载</h3> <p><img src="/note/assets/img/pt-16.26053b7b.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://github.com/prometheus/node_exporter/releases/download/v1.1.2/node_exporter-1.1.2.linux-arm64.tar.gz
<span class="token function">tar</span> -xzvf node_exporter-1.1.2.linux-amd64.tar.gz
<span class="token function">mv</span> node_exporter-1.1.2.linux-amd64 /usr/local/Prometheus/node_exporter
</code></pre></div><h3 id="_2、启动-2"><a href="#_2、启动-2" class="header-anchor">#</a> 2、启动</h3> <ul><li>添加启动服务</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /usr/lib/systemd/system/node_exporter.service
</code></pre></div><ul><li>为了方便管理使用系统服务管理</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>node_exporter
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
<span class="token assign-left variable">User</span><span class="token operator">=</span>root
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/Prometheus/node_exporter/node_exporter --web.listen-address<span class="token operator">=</span>localhost:9101
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill -HUP <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> node_exporter.service
systemctl start node_exporter.service
systemctl status node_exporter.service
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 将node_exporter添加到Prometheus服务器</span>
<span class="token function">vim</span> /usr/local/prometheus/prometheus/prometheus.yml
<span class="token comment"># 在'scrape_config'下添加node_exporter的job  - job_name: 'node_exporter'</span>
</code></pre></div><h3 id="_3、重新配置-prometheus"><a href="#_3、重新配置-prometheus" class="header-anchor">#</a> 3、重新配置 Prometheus</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /usr/local/Prometheus/prometheus.yml
</code></pre></div><p>追加</p> <div class="language-shell extra-class"><pre class="language-shell"><code>scrape_configs:
  <span class="token comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span>
  - job_name: <span class="token string">'prometheus'</span>

    <span class="token comment"># metrics_path defaults to '/metrics'</span>
    <span class="token comment"># scheme defaults to 'http'.</span>

    static_configs:
    - targets: <span class="token punctuation">[</span><span class="token string">'localhost:9090'</span><span class="token punctuation">]</span>
<span class="token comment">#追加以下内容</span>
  - job_name: <span class="token string">'node_exporter-1'</span>
    static_configs:
    - targets: <span class="token punctuation">[</span><span class="token string">'localhost:9101'</span><span class="token punctuation">]</span> <span class="token comment">#安装node_exporter的服务器</span>
</code></pre></div><ul><li>重新启动</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl restart prometheus
</code></pre></div><h2 id="六-架构图"><a href="#六-架构图" class="header-anchor">#</a> 六，架构图</h2> <p>如果要想监控，前提是能获取被监控端指标数据，并且这个 数据格式必须遵循Prometheus数据模型，这样才能识别和 采集，一般使用exporter提供监控指标数据。</p> <ul><li>exporter列表： https://prometheus.io/docs/instrumenting/exporters</li></ul> <p><img src="/note/assets/img/pt-15.a555f842.png" alt=""></p> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <h3 id="_1-出现以下错误"><a href="#_1-出现以下错误" class="header-anchor">#</a> 1. 出现以下错误</h3> <div class="language- extra-class"><pre class="language-text"><code>错误：rpmdb: BDB0113 Thread/process 21983/140193275361280 failed: BDB1507 Thread died in Berkeley DB library
错误：db5 错误(-30973) 来自 dbenv-&gt;failchk：BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery
错误：无法使用 db5 -  (-30973) 打开 Packages 索引
错误：无法从 /var/lib/rpm 打开软件包数据库
CRITICAL:yum.main:

Error: rpmdb open failed
</code></pre></div><p>解决：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#b删除/var/lib/rpm目录下的__db开头的rpmdb文件</span>

<span class="token function">rm</span> -f /var/lib/rpm/__db*

<span class="token comment"># rpm数据库重建</span>

<span class="token function">rpm</span> --rebuilddb

<span class="token comment"># 清理所有yum缓存</span>

yum clean all

<span class="token comment"># 重新生成yum缓存</span>

yum makecache
</code></pre></div><h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <h3 id="_1、linux-查看进程占用端口"><a href="#_1、linux-查看进程占用端口" class="header-anchor">#</a> 1、Linux 查看进程占用端口</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> node_exporter
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">netstat</span> -nap <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">26608</span>
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#简介" title="简介">简介</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#一、基础环境" title="一、基础环境">一、基础环境</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#二、安装go" title="二、安装Go">二、安装Go</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1、下载解压安装" title="1、下载解压安装">1、下载解压安装</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2、配置环境变量" title="2、配置环境变量">2、配置环境变量</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3、验证" title="3、验证">3、验证</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#三、安装prometheus" title="三、安装Prometheus">三、安装Prometheus</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1、下载、解压、设置软连接" title="1、下载、解压、设置软连接">1、下载、解压、设置软连接</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2、启动" title="2、启动">2、启动</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3、验证-2" title="3、验证">3、验证</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#四、安装grafana" title="四、安装Grafana">四、安装Grafana</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1、打开官网并下载" title="1、打开官网并下载">1、打开官网并下载</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2、安装" title="2、安装">2、安装</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3、启动" title="3、启动">3、启动</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4、访问grafana" title="4、访问Grafana">4、访问Grafana</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_5、与-prometheus-交互" title="5、与 Prometheus 交互">5、与 Prometheus 交互</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#五、配置-node-exporter" title="五、配置 Node_Exporter">五、配置 Node_Exporter</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1、下载" title="1、下载">1、下载</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2、启动-2" title="2、启动">2、启动</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3、重新配置-prometheus" title="3、重新配置 Prometheus">3、重新配置 Prometheus</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#六-架构图" title="六，架构图">六，架构图</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#问题" title="问题">问题</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-出现以下错误" title="1. 出现以下错误">1. 出现以下错误</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#扩展" title="扩展">扩展</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1、linux-查看进程占用端口" title="1、Linux 查看进程占用端口">1、Linux 查看进程占用端口</a></div></div></div></div> <footer class="footer" data-v-4f6150ea><div class="footer-left-wrap" data-v-4f6150ea><ul class="contact" data-v-4f6150ea><li class="contact-item" data-v-4f6150ea><a href="https://github.com/mhxw" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-4f6150ea><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-4f6150ea><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-4f6150ea></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-4f6150ea><ul class="copyright" data-v-4f6150ea><li class="copyright-item" data-v-4f6150ea>Copyright © 2017-Present Powered by MHXW</li></ul></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.36252550.js" defer></script><script src="/note/assets/js/8.2b515bb1.js" defer></script><script src="/note/assets/js/3.f6739d14.js" defer></script><script src="/note/assets/js/5.e5967abf.js" defer></script><script src="/note/assets/js/11.103ea2f0.js" defer></script>
  </body>
</html>
