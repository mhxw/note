<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何在Golang中正确使用基本身份认证（HTTP Basic Authentication） | MHXW</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/note/logo.png">
    <link rel="alternate" type="application/rss+xml" href="https://mhxw.life/rss.xml" title="MHXW RSS Feed">
    <meta name="description" content="在Go1.4版本中引入了HTTP基本身份认证模块 。

什么是基本认证？我应该在什么时候使用它？

作为开发人员，您可能访问受保护的网址时，Web 浏览器显示以下弹框。

弹框截图

当您在此提示输入用户名和密码时，Web 浏览器将向服务器发送一个 ...">
    <meta name="MHXW" content="mhxw blog">
    
    <link rel="preload" href="/note/assets/css/0.styles.15d6f971.css" as="style"><link rel="preload" href="/note/assets/js/app.36252550.js" as="script"><link rel="preload" href="/note/assets/js/8.2b515bb1.js" as="script"><link rel="preload" href="/note/assets/js/3.f6739d14.js" as="script"><link rel="preload" href="/note/assets/js/12.4d636b7f.js" as="script"><link rel="preload" href="/note/assets/js/11.103ea2f0.js" as="script"><link rel="prefetch" href="/note/assets/js/10.6929b2b7.js"><link rel="prefetch" href="/note/assets/js/13.d93a6436.js"><link rel="prefetch" href="/note/assets/js/14.521720fc.js"><link rel="prefetch" href="/note/assets/js/15.fe7581b1.js"><link rel="prefetch" href="/note/assets/js/16.fd0d2525.js"><link rel="prefetch" href="/note/assets/js/17.bd669e5d.js"><link rel="prefetch" href="/note/assets/js/18.49681434.js"><link rel="prefetch" href="/note/assets/js/19.dff2ad59.js"><link rel="prefetch" href="/note/assets/js/20.97e79743.js"><link rel="prefetch" href="/note/assets/js/21.c93097bc.js"><link rel="prefetch" href="/note/assets/js/22.429da250.js"><link rel="prefetch" href="/note/assets/js/23.730f8451.js"><link rel="prefetch" href="/note/assets/js/24.6eed2fc2.js"><link rel="prefetch" href="/note/assets/js/25.6ccaca11.js"><link rel="prefetch" href="/note/assets/js/26.a22dd40f.js"><link rel="prefetch" href="/note/assets/js/27.78579ce9.js"><link rel="prefetch" href="/note/assets/js/28.b4036104.js"><link rel="prefetch" href="/note/assets/js/29.4aa3c2c4.js"><link rel="prefetch" href="/note/assets/js/30.3a3b493c.js"><link rel="prefetch" href="/note/assets/js/31.57fab91c.js"><link rel="prefetch" href="/note/assets/js/32.47a51bf2.js"><link rel="prefetch" href="/note/assets/js/33.13e1708f.js"><link rel="prefetch" href="/note/assets/js/34.2b92be19.js"><link rel="prefetch" href="/note/assets/js/35.3536a88d.js"><link rel="prefetch" href="/note/assets/js/36.1c3e47e9.js"><link rel="prefetch" href="/note/assets/js/4.638b10e5.js"><link rel="prefetch" href="/note/assets/js/5.e5967abf.js"><link rel="prefetch" href="/note/assets/js/6.c4877f48.js"><link rel="prefetch" href="/note/assets/js/7.e800e18b.js"><link rel="prefetch" href="/note/assets/js/9.632d5cc1.js"><link rel="prefetch" href="/note/assets/js/vuejs-paginate.92caeb0c.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.15d6f971.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/note/" class="nav-link home-link">MHXW </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/note/" class="nav-link">首页</a></li><li class="nav-item"><a href="/note/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="/note/about.html" class="nav-link">关于</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/note/" class="nav-link mobile-home-link">MHXW </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/note/" class="nav-link">首页</a></li><li class="mobile-nav-item"><a href="/note/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="/note/about.html" class="nav-link">关于</a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        如何在Golang中正确使用基本身份认证（HTTP Basic Authentication）
      </h1> <div class="post-meta"><div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-7-15">
        2021-07-15
      </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-450235f2><a href="/note/tag/basic-auth" data-v-450235f2><span data-v-450235f2>basic-auth</span></a></li><li class="post-tag" data-v-450235f2><a href="/note/tag/golang" data-v-450235f2><span data-v-450235f2>golang</span></a></li><li class="post-tag" data-v-450235f2><a href="/note/tag/tutorial" data-v-450235f2><span data-v-450235f2>tutorial</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>在Go1.4版本中引入了<a href="https://pkg.go.dev/net/http#Request.BasicAuth" target="_blank" rel="noopener noreferrer">HTTP基本身份认证模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。</p> <h2 id="什么是基本认证-我应该在什么时候使用它"><a href="#什么是基本认证-我应该在什么时候使用它" class="header-anchor">#</a> 什么是基本认证？我应该在什么时候使用它？</h2> <p>作为开发人员，您可能访问受保护的网址时，Web 浏览器显示以下弹框。</p> <p><img src="/note/assets/img/baig-1.d9959a7a.jpg" alt="弹框截图"></p> <p>当您在此提示输入用户名和密码时，Web 浏览器将向服务器发送一个包含<code>Authorization</code>标头的 HTTP 请求，类似于：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Authorization: Basic <span class="token assign-left variable">YWxpY2U6cGE1NXdvcmQ</span><span class="token operator">=</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>Authorization: Basic base64encode<span class="token punctuation">(</span>username+<span class="token string">&quot;:&quot;</span>+password<span class="token punctuation">)</span>
</code></pre></div><p>HTTP协议中的 <code>Authorization</code> 请求消息头含有服务器用于验证用户代理身份的凭证。格式是<code>Basic</code>字符串+空格+用户名:密码的Base64编码。在上述示例中，<code>YWxpY2U6cGE1NXdvcmQ=</code>= 是用户名:密码的base64编码。</p> <p>当服务器收到这个请求时，它会从<code>Authorization</code>中解析用户名和密码并检查它们是否有效。如果凭据无效，服务器返回<code>401 Unauthorized</code>响应，浏览器可以再次显示弹框。</p> <p>基本身份验证可用于许多不同的场景，但它通常适合于对安全性要求不高的系统或设备中。</p> <p>为了提高其安全性，您可以：</p> <ul><li><p>只在 HTTPS 连接上使用它：如果您不使用 HTTPS，<code>Authorization</code>请求消息头可能会被攻击者拦截和解码，然后他们可以使用用户名和密码来访问您受保护的资源。</p></li> <li><p>使用攻击者难以猜测或暴力破解的强密码。</p></li></ul> <h2 id="保护-web-应用程序"><a href="#保护-web-应用程序" class="header-anchor">#</a> 保护 Web 应用程序</h2> <p>保护程序最简单的方法的是创建一些中间件。我们需要做到以下几点：</p> <ul><li><p>从<code>Authorization</code>请求消息头中解析用户名和密码（如果存在）。建议直接使用Go 1.4 中引入的方法：<code>r.BasicAuth()</code>。</p></li> <li><p>将提供的用户名和密码与您期望的值进行比较。为了避免定时攻击的风险，你应该使用 Go 的<code>subtle.ConstantTimeCompare()</code>函数进行比较。</p></li></ul> <blockquote><p>注意：</p> <p>在Go中（和大多数语言一样），普通的==比较运算符一旦发现两个字符串之间有差异，就会立即返回。因此，如果第一个字符是不同的，它将在只看一个字符后返回。从理论上讲，这为<a href="">定时攻击</a>提供了机会，攻击者可以向你的应用程序发出大量请求，并查看平均响应时间的差异。他们收到401响应所需的时间可以有效地告诉他们有多少字符是正确的，如果有足够的请求，他们可以建立一个完整的用户名和密码的画像。像网络抖动这样的事情使得这种特定的攻击很难实现，但远程定时攻击已经成为现实，而且在未来可能变得更加可行。考虑到这个因素我们可以通过使用subtle.ConstantTimeCompare()很容易地防范这种风险，这样做是有意义的。</p></blockquote> <p>同样要注意的是，使用<code>subtle.ConstantTimeCompare()</code>可能会 <a href="https://github.com/golang/go/issues/18936" target="_blank" rel="noopener noreferrer">泄露有关用户名和密码长度的信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。为了防范这种情况，我们应该在它们比较之前使用散列函数加密（比如：SHA-256）用户名和密码。使用加密后的用户名和密码镜像比较来防止<code>subtle.ConstantTimeCompare()</code> 提前返回。</p> <ul><li>如果用户名和密码不正确，或者请求不包含有效的<code>Authorization</code>消息头，那么中间件应该发送<code>401 Unauthorized</code>响应并设置 <a href="https://datatracker.ietf.org/doc/html/rfc7235#section-4.1" target="_blank" rel="noopener noreferrer">WWW-Authenticate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 消息头以通知客户端应该使用基本身份验证来获得访问权限。否则，中间件应该允许请求进行下一步。</li></ul> <p>综上所述，实现中间件的案例如下所示：</p> <div class="language-golang extra-class"><pre class="language-text"><code>func basicAuth(next http.HandlerFunc) http.HandlerFunc {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // Extract the username and password from the request 
        // Authorization header. If no Authentication header is present 
        // or the header value is invalid, then the 'ok' return value 
        // will be false.
		username, password, ok := r.BasicAuth()
		if ok {
            // Calculate SHA-256 hashes for the provided and expected
            // usernames and passwords.
			usernameHash := sha256.Sum256([]byte(username))
			passwordHash := sha256.Sum256([]byte(password))
			expectedUsernameHash := sha256.Sum256([]byte(&quot;your expected username&quot;))
			expectedPasswordHash := sha256.Sum256([]byte(&quot;your expected password&quot;))

            // 使用 subtle.ConstantTimeCompare() 进行校验
            // the provided username and password hashes equal the  
            // expected username and password hashes. ConstantTimeCompare
            // 如果值相等，则返回1，否则返回0。
            // Importantly, we should to do the work to evaluate both the 
            // username and password before checking the return values to 
            // 避免泄露信息。
			usernameMatch := (subtle.ConstantTimeCompare(usernameHash[:], expectedUsernameHash[:]) == 1)
			passwordMatch := (subtle.ConstantTimeCompare(passwordHash[:], expectedPasswordHash[:]) == 1)

            // If the username and password are correct, then call
            // the next handler in the chain. Make sure to return 
            // afterwards, so that none of the code below is run.
			if usernameMatch &amp;&amp; passwordMatch {
				next.ServeHTTP(w, r)
				return
			}
		}

        // If the Authentication header is not present, is invalid, or the
        // username or password is wrong, then set a WWW-Authenticate 
        // header to inform the client that we expect them to use basic
        // authentication and send a 401 Unauthorized response.
		w.Header().Set(&quot;WWW-Authenticate&quot;, `Basic realm=&quot;restricted&quot;, charset=&quot;UTF-8&quot;`)
		http.Error(w, &quot;Unauthorized&quot;, http.StatusUnauthorized)
	})
}
</code></pre></div><h2 id="案例代码"><a href="#案例代码" class="header-anchor">#</a> 案例代码</h2> <p>至此，让我们编写一个小型但功能齐全的项目测试一下。</p> <p>在您的计算机上创建一个新目录，添加一个<code>main.go</code>文件，初始化一个<code>mod</code>，并使用 <a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noopener noreferrer">mkcert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 工具创建一对本地信任的 TLS 证书。就像这样：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> basic-auth-example
$ <span class="token builtin class-name">cd</span> basic-auth-example
$ <span class="token function">touch</span> main.go
$ go mod init example.com/basic-auth-example
go: creating new go.mod: module example.com/basic-auth-example
$ mkcert localhost
Created a new certificate valid <span class="token keyword">for</span> the following names 📜
     - <span class="token string">&quot;localhost&quot;</span>
    
    The certificate is at <span class="token string">&quot;./localhost.pem&quot;</span> and the key at <span class="token string">&quot;./localhost-key.pem&quot;</span> ✅
    
    It will expire on <span class="token number">21</span> September <span class="token number">2023</span> 🗓
$ <span class="token function">ls</span>
go.mod  localhost-key.pem  localhost.pem  main.go
</code></pre></div><p>把以下代码复制到<code>mian.go</code>中</p> <div class="language-shell extra-class"><pre class="language-shell"><code>package main

<span class="token function">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;crypto/sha256&quot;</span>
	<span class="token string">&quot;crypto/subtle&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token builtin class-name">type</span> application struct <span class="token punctuation">{</span>
	auth struct <span class="token punctuation">{</span>
		username string
		password string
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	app :<span class="token operator">=</span> new<span class="token punctuation">(</span>application<span class="token punctuation">)</span>

	app.auth.username <span class="token operator">=</span> <span class="token string">&quot;mhxw&quot;</span>
	app.auth.password <span class="token operator">=</span> <span class="token string">&quot;mhxw_password&quot;</span>

	<span class="token keyword">if</span> app.auth.username <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		log.Fatal<span class="token punctuation">(</span><span class="token string">&quot;basic auth username must be provided&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> app.auth.password <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		log.Fatal<span class="token punctuation">(</span><span class="token string">&quot;basic auth password must be provided&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	mux :<span class="token operator">=</span> http.NewServeMux<span class="token punctuation">(</span><span class="token punctuation">)</span>
	mux.HandleFunc<span class="token punctuation">(</span><span class="token string">&quot;/unprotected&quot;</span>, app.unprotectedHandler<span class="token punctuation">)</span>
	mux.HandleFunc<span class="token punctuation">(</span><span class="token string">&quot;/protected&quot;</span>, app.basicAuth<span class="token punctuation">(</span>app.protectedHandler<span class="token punctuation">))</span>

	srv :<span class="token operator">=</span> <span class="token operator">&amp;</span>http.Server<span class="token punctuation">{</span>
		Addr:         <span class="token string">&quot;:4000&quot;</span>,
		Handler:      mux,
		IdleTimeout:  time.Minute,
		ReadTimeout:  <span class="token number">10</span> * time.Second,
		WriteTimeout: <span class="token number">30</span> * time.Second,
	<span class="token punctuation">}</span>

	log.Printf<span class="token punctuation">(</span><span class="token string">&quot;starting server on %s&quot;</span>, srv.Addr<span class="token punctuation">)</span>
	err :<span class="token operator">=</span> srv.ListenAndServeTLS<span class="token punctuation">(</span><span class="token string">&quot;./localhost.pem&quot;</span>, <span class="token string">&quot;./localhost-key.pem&quot;</span><span class="token punctuation">)</span>
	log.Fatal<span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>app *application<span class="token punctuation">)</span> protectedHandler<span class="token punctuation">(</span>w http.ResponseWriter, r *http.Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt.Fprintln<span class="token punctuation">(</span>w, <span class="token string">&quot;This is the protected handler&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>app *application<span class="token punctuation">)</span> unprotectedHandler<span class="token punctuation">(</span>w http.ResponseWriter, r *http.Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt.Fprintln<span class="token punctuation">(</span>w, <span class="token string">&quot;This is the unprotected handler&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>app *application<span class="token punctuation">)</span> basicAuth<span class="token punctuation">(</span>next http.HandlerFunc<span class="token punctuation">)</span> http.HandlerFunc <span class="token punctuation">{</span>
	<span class="token builtin class-name">return</span> func<span class="token punctuation">(</span>w http.ResponseWriter, r *http.Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		username, password, ok :<span class="token operator">=</span> r.BasicAuth<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
			usernameHash :<span class="token operator">=</span> sha256.Sum256<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>byte<span class="token punctuation">(</span>username<span class="token punctuation">))</span>
			passwordHash :<span class="token operator">=</span> sha256.Sum256<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>byte<span class="token punctuation">(</span>password<span class="token punctuation">))</span>
			expectedUsernameHash :<span class="token operator">=</span> sha256.Sum256<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>byte<span class="token punctuation">(</span>app.auth.username<span class="token punctuation">))</span>
			expectedPasswordHash :<span class="token operator">=</span> sha256.Sum256<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>byte<span class="token punctuation">(</span>app.auth.password<span class="token punctuation">))</span>

			usernameMatch :<span class="token operator">=</span> subtle.ConstantTimeCompare<span class="token punctuation">(</span>usernameHash<span class="token punctuation">[</span>:<span class="token punctuation">]</span>, expectedUsernameHash<span class="token punctuation">[</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
			passwordMatch :<span class="token operator">=</span> subtle.ConstantTimeCompare<span class="token punctuation">(</span>passwordHash<span class="token punctuation">[</span>:<span class="token punctuation">]</span>, expectedPasswordHash<span class="token punctuation">[</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>

			<span class="token keyword">if</span> usernameMatch <span class="token operator">&amp;&amp;</span> passwordMatch <span class="token punctuation">{</span>
				next.ServeHTTP<span class="token punctuation">(</span>w, r<span class="token punctuation">)</span>
				<span class="token builtin class-name">return</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		w.Header<span class="token punctuation">(</span><span class="token punctuation">)</span>.Set<span class="token punctuation">(</span><span class="token string">&quot;WWW-Authenticate&quot;</span>, <span class="token variable"><span class="token variable">`</span>Basic <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">&quot;restricted&quot;</span>, <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token variable">`</span></span><span class="token punctuation">)</span>
		http.Error<span class="token punctuation">(</span>w, <span class="token string">&quot;Unauthorized&quot;</span>, http.StatusUnauthorized<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行以上案例，您可以在浏览器访问网址：<code>https://localhost:4000/protected</code> ，您可以看到浏览器弹出的基本身份认证提示。</p> <p>或者，您可以发送一些<code>curl</code>请求来验证<code>基本身份认证</code>是否正常工作</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> -i https://localhost:4000/unprotected
HTTP/2 <span class="token number">200</span> 
content-type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
content-length: <span class="token number">32</span>
date: Sun, <span class="token number">20</span> Jun <span class="token number">2021</span> <span class="token number">14</span>:09:56 GMT

This is the unprotected handler

$ <span class="token function">curl</span> -i https://localhost:4000/protected
HTTP/2 <span class="token number">401</span> 
content-type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
www-authenticate: Basic <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">&quot;restricted&quot;</span>, <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>
x-content-type-options: nosniff
content-length: <span class="token number">13</span>
date: Sun, <span class="token number">20</span> Jun <span class="token number">2021</span> <span class="token number">14</span>:09:59 GMT

Unauthorized

$ <span class="token function">curl</span> -i -u alice:p8fnxeqj5a7zbrqp https://localhost:4000/protected
HTTP/2 <span class="token number">200</span> 
content-type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
content-length: <span class="token number">30</span>
date: Sun, <span class="token number">20</span> Jun <span class="token number">2021</span> <span class="token number">14</span>:10:14 GMT

This is the protected handler

$ <span class="token function">curl</span> -i -u alice:wrongPa55word https://localhost:4000/protected
HTTP/2 <span class="token number">401</span> 
content-type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
www-authenticate: Basic <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">&quot;restricted&quot;</span>, <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>
x-content-type-options: nosniff
content-length: <span class="token number">13</span>
date: Sun, <span class="token number">20</span> Jun <span class="token number">2021</span> <span class="token number">14</span>:15:30 GMT

Unauthorized
</code></pre></div><h2 id="向受保护的http资源发出请求"><a href="#向受保护的http资源发出请求" class="header-anchor">#</a> 向受保护的HTTP资源发出请求</h2> <p>当您需要访问受保护的资源时，Go可以让您变得非常简单。您需要做的是在执行请求之前调用<a href="https://pkg.go.dev/net/http#Request.SetBasicAuth" target="_blank" rel="noopener noreferrer">r.SetBasicAuth()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法。如以下案例</p> <div class="language-shell extra-class"><pre class="language-shell"><code>package main

<span class="token function">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;io&quot;</span>
    <span class="token string">&quot;log&quot;</span>
    <span class="token string">&quot;net/http&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client :<span class="token operator">=</span> http.Client<span class="token punctuation">{</span>Timeout: <span class="token number">5</span> * time.Second<span class="token punctuation">}</span>

    req, err :<span class="token operator">=</span> http.NewRequest<span class="token punctuation">(</span>http.MethodGet, <span class="token string">&quot;https://localhost:4000/protected&quot;</span>, http.NoBody<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
        log.Fatal<span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    req.SetBasicAuth<span class="token punctuation">(</span><span class="token string">&quot;alice&quot;</span>, <span class="token string">&quot;p8fnxeqj5a7zbrqp&quot;</span><span class="token punctuation">)</span>

    res, err :<span class="token operator">=</span> client.Do<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
        log.Fatal<span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    defer res.Body.Close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    resBody, err :<span class="token operator">=</span> io.ReadAll<span class="token punctuation">(</span>res.Body<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
        log.Fatal<span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt.Printf<span class="token punctuation">(</span><span class="token string">&quot;Status: %d<span class="token entity" title="\n">\n</span>&quot;</span>, res.StatusCode<span class="token punctuation">)</span>
    fmt.Printf<span class="token punctuation">(</span><span class="token string">&quot;Body: %s<span class="token entity" title="\n">\n</span>&quot;</span>, string<span class="token punctuation">(</span>resBody<span class="token punctuation">))</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>https://mhxw.life
https://www.alexedwards.net/blog/basic-authentication-in-go
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#什么是基本认证-我应该在什么时候使用它" title="什么是基本认证？我应该在什么时候使用它？">什么是基本认证？我应该在什么时候使用它？</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#保护-web-应用程序" title="保护 Web 应用程序">保护 Web 应用程序</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#案例代码" title="案例代码">案例代码</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#向受保护的http资源发出请求" title="向受保护的HTTP资源发出请求">向受保护的HTTP资源发出请求</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#参考文档" title="参考文档">参考文档</a></div></div></div></div> <footer class="footer" data-v-4f6150ea><div class="footer-left-wrap" data-v-4f6150ea><ul class="contact" data-v-4f6150ea><li class="contact-item" data-v-4f6150ea><a href="https://github.com/mhxw" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-4f6150ea><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-4f6150ea><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-4f6150ea></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-4f6150ea><ul class="copyright" data-v-4f6150ea><li class="copyright-item" data-v-4f6150ea>Copyright © 2017-Present Powered by MHXW</li></ul></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.36252550.js" defer></script><script src="/note/assets/js/8.2b515bb1.js" defer></script><script src="/note/assets/js/3.f6739d14.js" defer></script><script src="/note/assets/js/12.4d636b7f.js" defer></script><script src="/note/assets/js/11.103ea2f0.js" defer></script>
  </body>
</html>
