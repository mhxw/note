(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{402:function(t,s,a){t.exports=a.p+"assets/img/baig-1.d9959a7a.jpg"},448:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("在Go1.4版本中引入了"),n("a",{attrs:{href:"https://pkg.go.dev/net/http#Request.BasicAuth",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP基本身份认证模块"),n("OutboundLink")],1),t._v(" 。")]),t._v(" "),n("h2",{attrs:{id:"什么是基本认证-我应该在什么时候使用它"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是基本认证-我应该在什么时候使用它"}},[t._v("#")]),t._v(" 什么是基本认证？我应该在什么时候使用它？")]),t._v(" "),n("p",[t._v("作为开发人员，您可能访问受保护的网址时，Web 浏览器显示以下弹框。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(402),alt:"弹框截图"}})]),t._v(" "),n("p",[t._v("当您在此提示输入用户名和密码时，Web 浏览器将向服务器发送一个包含"),n("code",[t._v("Authorization")]),t._v("标头的 HTTP 请求，类似于：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("Authorization: Basic "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("YWxpY2U6cGE1NXdvcmQ")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("Authorization: Basic base64encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username+"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),t._v("+password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("HTTP协议中的 "),n("code",[t._v("Authorization")]),t._v(" 请求消息头含有服务器用于验证用户代理身份的凭证。格式是"),n("code",[t._v("Basic")]),t._v("字符串+空格+用户名:密码的Base64编码。在上述示例中，"),n("code",[t._v("YWxpY2U6cGE1NXdvcmQ=")]),t._v("= 是用户名:密码的base64编码。")]),t._v(" "),n("p",[t._v("当服务器收到这个请求时，它会从"),n("code",[t._v("Authorization")]),t._v("中解析用户名和密码并检查它们是否有效。如果凭据无效，服务器返回"),n("code",[t._v("401 Unauthorized")]),t._v("响应，浏览器可以再次显示弹框。")]),t._v(" "),n("p",[t._v("基本身份验证可用于许多不同的场景，但它通常适合于对安全性要求不高的系统或设备中。")]),t._v(" "),n("p",[t._v("为了提高其安全性，您可以：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("只在 HTTPS 连接上使用它：如果您不使用 HTTPS，"),n("code",[t._v("Authorization")]),t._v("请求消息头可能会被攻击者拦截和解码，然后他们可以使用用户名和密码来访问您受保护的资源。")])]),t._v(" "),n("li",[n("p",[t._v("使用攻击者难以猜测或暴力破解的强密码。")])])]),t._v(" "),n("h2",{attrs:{id:"保护-web-应用程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#保护-web-应用程序"}},[t._v("#")]),t._v(" 保护 Web 应用程序")]),t._v(" "),n("p",[t._v("保护程序最简单的方法的是创建一些中间件。我们需要做到以下几点：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("从"),n("code",[t._v("Authorization")]),t._v("请求消息头中解析用户名和密码（如果存在）。建议直接使用Go 1.4 中引入的方法："),n("code",[t._v("r.BasicAuth()")]),t._v("。")])]),t._v(" "),n("li",[n("p",[t._v("将提供的用户名和密码与您期望的值进行比较。为了避免定时攻击的风险，你应该使用 Go 的"),n("code",[t._v("subtle.ConstantTimeCompare()")]),t._v("函数进行比较。")])])]),t._v(" "),n("blockquote",[n("p",[t._v("注意：")]),t._v(" "),n("p",[t._v("在Go中（和大多数语言一样），普通的==比较运算符一旦发现两个字符串之间有差异，就会立即返回。因此，如果第一个字符是不同的，它将在只看一个字符后返回。从理论上讲，这为"),n("a",{attrs:{href:""}},[t._v("定时攻击")]),t._v("提供了机会，攻击者可以向你的应用程序发出大量请求，并查看平均响应时间的差异。他们收到401响应所需的时间可以有效地告诉他们有多少字符是正确的，如果有足够的请求，他们可以建立一个完整的用户名和密码的画像。像网络抖动这样的事情使得这种特定的攻击很难实现，但远程定时攻击已经成为现实，而且在未来可能变得更加可行。考虑到这个因素我们可以通过使用subtle.ConstantTimeCompare()很容易地防范这种风险，这样做是有意义的。")])]),t._v(" "),n("p",[t._v("同样要注意的是，使用"),n("code",[t._v("subtle.ConstantTimeCompare()")]),t._v("可能会 "),n("a",{attrs:{href:"https://github.com/golang/go/issues/18936",target:"_blank",rel:"noopener noreferrer"}},[t._v("泄露有关用户名和密码长度的信息"),n("OutboundLink")],1),t._v(" 。为了防范这种情况，我们应该在它们比较之前使用散列函数加密（比如：SHA-256）用户名和密码。使用加密后的用户名和密码镜像比较来防止"),n("code",[t._v("subtle.ConstantTimeCompare()")]),t._v(" 提前返回。")]),t._v(" "),n("ul",[n("li",[t._v("如果用户名和密码不正确，或者请求不包含有效的"),n("code",[t._v("Authorization")]),t._v("消息头，那么中间件应该发送"),n("code",[t._v("401 Unauthorized")]),t._v("响应并设置 "),n("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc7235#section-4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("WWW-Authenticate"),n("OutboundLink")],1),t._v(" 消息头以通知客户端应该使用基本身份验证来获得访问权限。否则，中间件应该允许请求进行下一步。")])]),t._v(" "),n("p",[t._v("综上所述，实现中间件的案例如下所示：")]),t._v(" "),n("div",{staticClass:"language-golang extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('func basicAuth(next http.HandlerFunc) http.HandlerFunc {\n\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // Extract the username and password from the request \n        // Authorization header. If no Authentication header is present \n        // or the header value is invalid, then the \'ok\' return value \n        // will be false.\n\t\tusername, password, ok := r.BasicAuth()\n\t\tif ok {\n            // Calculate SHA-256 hashes for the provided and expected\n            // usernames and passwords.\n\t\t\tusernameHash := sha256.Sum256([]byte(username))\n\t\t\tpasswordHash := sha256.Sum256([]byte(password))\n\t\t\texpectedUsernameHash := sha256.Sum256([]byte("your expected username"))\n\t\t\texpectedPasswordHash := sha256.Sum256([]byte("your expected password"))\n\n            // 使用 subtle.ConstantTimeCompare() 进行校验\n            // the provided username and password hashes equal the  \n            // expected username and password hashes. ConstantTimeCompare\n            // 如果值相等，则返回1，否则返回0。\n            // Importantly, we should to do the work to evaluate both the \n            // username and password before checking the return values to \n            // 避免泄露信息。\n\t\t\tusernameMatch := (subtle.ConstantTimeCompare(usernameHash[:], expectedUsernameHash[:]) == 1)\n\t\t\tpasswordMatch := (subtle.ConstantTimeCompare(passwordHash[:], expectedPasswordHash[:]) == 1)\n\n            // If the username and password are correct, then call\n            // the next handler in the chain. Make sure to return \n            // afterwards, so that none of the code below is run.\n\t\t\tif usernameMatch && passwordMatch {\n\t\t\t\tnext.ServeHTTP(w, r)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n        // If the Authentication header is not present, is invalid, or the\n        // username or password is wrong, then set a WWW-Authenticate \n        // header to inform the client that we expect them to use basic\n        // authentication and send a 401 Unauthorized response.\n\t\tw.Header().Set("WWW-Authenticate", `Basic realm="restricted", charset="UTF-8"`)\n\t\thttp.Error(w, "Unauthorized", http.StatusUnauthorized)\n\t})\n}\n')])])]),n("h2",{attrs:{id:"案例代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例代码"}},[t._v("#")]),t._v(" 案例代码")]),t._v(" "),n("p",[t._v("至此，让我们编写一个小型但功能齐全的项目测试一下。")]),t._v(" "),n("p",[t._v("在您的计算机上创建一个新目录，添加一个"),n("code",[t._v("main.go")]),t._v("文件，初始化一个"),n("code",[t._v("mod")]),t._v("，并使用 "),n("a",{attrs:{href:"https://github.com/FiloSottile/mkcert",target:"_blank",rel:"noopener noreferrer"}},[t._v("mkcert"),n("OutboundLink")],1),t._v(" 工具创建一对本地信任的 TLS 证书。就像这样：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" basic-auth-example\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" basic-auth-example\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" main.go\n$ go mod init example.com/basic-auth-example\ngo: creating new go.mod: module example.com/basic-auth-example\n$ mkcert localhost\nCreated a new certificate valid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the following names 📜\n     - "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\n    \n    The certificate is at "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./localhost.pem"')]),t._v(" and the key at "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./localhost-key.pem"')]),t._v(" ✅\n    \n    It will expire on "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" September "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),t._v(" 🗓\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\ngo.mod  localhost-key.pem  localhost.pem  main.go\n")])])]),n("p",[t._v("把以下代码复制到"),n("code",[t._v("mian.go")]),t._v("中")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("package main\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crypto/sha256"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crypto/subtle"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" application struct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tauth struct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tusername string\n\t\tpassword string\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfunc "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tapp :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tapp.auth.username "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mhxw"')]),t._v("\n\tapp.auth.password "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mhxw_password"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" app.auth.username "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"basic auth username must be provided"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" app.auth.password "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"basic auth password must be provided"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tmux :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http.NewServeMux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tmux.HandleFunc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/unprotected"')]),t._v(", app.unprotectedHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tmux.HandleFunc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/protected"')]),t._v(", app.basicAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app.protectedHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\n\tsrv :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("http.Server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tAddr:         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('":4000"')]),t._v(",\n\t\tHandler:      mux,\n\t\tIdleTimeout:  time.Minute,\n\t\tReadTimeout:  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" * time.Second,\n\t\tWriteTimeout: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" * time.Second,\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tlog.Printf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"starting server on %s"')]),t._v(", srv.Addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\terr :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" srv.ListenAndServeTLS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./localhost.pem"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./localhost-key.pem"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tlog.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfunc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app *application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" protectedHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http.ResponseWriter, r *http.Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt.Fprintln"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w, "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is the protected handler"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfunc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app *application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" unprotectedHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http.ResponseWriter, r *http.Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt.Fprintln"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w, "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is the unprotected handler"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfunc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app *application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" basicAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next http.HandlerFunc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" http.HandlerFunc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" func"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http.ResponseWriter, r *http.Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tusername, password, ok :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r.BasicAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ok "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tusernameHash :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sha256.Sum256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\t\t\tpasswordHash :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sha256.Sum256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\t\t\texpectedUsernameHash :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sha256.Sum256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app.auth.username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\t\t\texpectedPasswordHash :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sha256.Sum256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app.auth.password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\n\t\t\tusernameMatch :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" subtle.ConstantTimeCompare"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("usernameHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", expectedUsernameHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t\t\tpasswordMatch :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" subtle.ConstantTimeCompare"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("passwordHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", expectedPasswordHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" usernameMatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" passwordMatch "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\tnext.ServeHTTP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w, r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\tw.Header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".Set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WWW-Authenticate"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("Basic "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("realm")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"restricted"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\thttp.Error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w, "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unauthorized"')]),t._v(", http.StatusUnauthorized"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("运行以上案例，您可以在浏览器访问网址："),n("code",[t._v("https://localhost:4000/protected")]),t._v(" ，您可以看到浏览器弹出的基本身份认证提示。")]),t._v(" "),n("p",[t._v("或者，您可以发送一些"),n("code",[t._v("curl")]),t._v("请求来验证"),n("code",[t._v("基本身份认证")]),t._v("是否正常工作")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -i https://localhost:4000/unprotected\nHTTP/2 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" \ncontent-type: text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\ncontent-length: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v("\ndate: Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Jun "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":09:56 GMT\n\nThis is the unprotected handler\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -i https://localhost:4000/protected\nHTTP/2 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),t._v(" \ncontent-type: text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\nwww-authenticate: Basic "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("realm")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"restricted"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),t._v("\nx-content-type-options: nosniff\ncontent-length: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\ndate: Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Jun "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":09:59 GMT\n\nUnauthorized\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -i -u alice:p8fnxeqj5a7zbrqp https://localhost:4000/protected\nHTTP/2 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" \ncontent-type: text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\ncontent-length: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\ndate: Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Jun "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":10:14 GMT\n\nThis is the protected handler\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -i -u alice:wrongPa55word https://localhost:4000/protected\nHTTP/2 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),t._v(" \ncontent-type: text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\nwww-authenticate: Basic "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("realm")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"restricted"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),t._v("\nx-content-type-options: nosniff\ncontent-length: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\ndate: Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Jun "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":15:30 GMT\n\nUnauthorized\n")])])]),n("h2",{attrs:{id:"向受保护的http资源发出请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#向受保护的http资源发出请求"}},[t._v("#")]),t._v(" 向受保护的HTTP资源发出请求")]),t._v(" "),n("p",[t._v("当您需要访问受保护的资源时，Go可以让您变得非常简单。您需要做的是在执行请求之前调用"),n("a",{attrs:{href:"https://pkg.go.dev/net/http#Request.SetBasicAuth",target:"_blank",rel:"noopener noreferrer"}},[t._v("r.SetBasicAuth()"),n("OutboundLink")],1),t._v(" 方法。如以下案例")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("package main\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nfunc "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    client :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http.Client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Timeout: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" * time.Second"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    req, err :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http.NewRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http.MethodGet, "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://localhost:4000/protected"')]),t._v(", http.NoBody"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" nil "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    req.SetBasicAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alice"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p8fnxeqj5a7zbrqp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    res, err :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client.Do"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" nil "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    defer res.Body.Close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    resBody, err :"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io.ReadAll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res.Body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" nil "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log.Fatal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    fmt.Printf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Status: %d'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v('"')]),t._v(", res.StatusCode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt.Printf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Body: %s'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v('"')]),t._v(", string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resBody"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"参考文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("https://mhxw.life\nhttps://www.alexedwards.net/blog/basic-authentication-in-go\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);