(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{447:function(t,e,s){"use strict";s.r(e);var a=s(11),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、介绍"}},[t._v("#")]),t._v(" 一、介绍")]),t._v(" "),s("p",[t._v("本篇文章是基于以下三篇的改良和升级，由宿主机安装改为Docker方式安装。")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/_posts/2021-4-25-install-prometheus-on-linux.html"}},[t._v("Prometheus+Grafana监控部署")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/_posts/2021-5-2-prometheus-alertmanager.html"}},[t._v("Prometheus监控平台AlertManager配置告警")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/_posts/2021-6-6-pushgateway.html"}},[t._v("Pushgateway 的安装和使用")])],1)]),t._v(" "),s("p",[t._v("Prometheus是一款基于时序数据库的开源监控告警系统。")]),t._v(" "),s("p",[t._v("主要特性（功能）#")]),t._v(" "),s("ul",[s("li",[t._v("多维数据模型（时序由 metric 名字和 k/v 的labels构成）")]),t._v(" "),s("li",[t._v("灵活的查询语言（PromQL）")]),t._v(" "),s("li",[t._v("无依赖的分布式存储；单节点服务器都是自治的")]),t._v(" "),s("li",[t._v("采用 http 协议，使用pull模式拉取数据，简单易懂")]),t._v(" "),s("li",[t._v("监控目标，可以采用服务发现和静态配置方式")]),t._v(" "),s("li",[t._v("支持多种统计数据模型和界面展示。可以和Grafana结合展示。")])]),t._v(" "),s("h2",{attrs:{id:"二、安装-prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、安装-prometheus"}},[t._v("#")]),t._v(" 二、安装 Prometheus")]),t._v(" "),s("p",[t._v("1.首先创建一个配置文件 "),s("code",[t._v("prometheus.yml")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/prometheus/prometheus/blob/main/documentation/examples/prometheus.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方模板"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建数据盘目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /mhxw/monitor/prometheus\n")])])]),s("p",[t._v("把编辑好的配置文件 "),s("code",[t._v("prometheus.yml")]),t._v(" 放置到 "),s("code",[t._v("prometheus")]),t._v(" 目录下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20602")]),t._v(":9090 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/prometheus\n")])])]),s("p",[t._v("配置说明")]),t._v(" "),s("ul",[s("li",[t._v("--config.file prometheus配置文件路径")]),t._v(" "),s("li",[t._v("--storage.tsdb.retention.time 保存时间")]),t._v(" "),s("li",[t._v("--storage.tsdb.path 数据存储路径")]),t._v(" "),s("li",[t._v('-v：冒号":"前面的目录是宿主机目录，后面的目录是容器内目录。')]),t._v(" "),s("li",[t._v('-p：冒号":"前面的目录是宿主机端口，后面的目录是容器内端口。')])]),t._v(" "),s("blockquote",[s("p",[t._v("注意")]),t._v(" "),s("p",[t._v("有没有发现默认使用 static_configs 静态配置方式，虽然可以正确配置，但是每次配置都需要重启 Prometheus 服务，当我们需要分批次添加很多 Node 时，频繁重启服务就会造成监控的多次中断，这太不友好了。当然 Prometheus 也提供了多种服务发现方式")])]),t._v(" "),s("ul",[s("li",[t._v("自动发现")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("- labels:\n    name: two\n  targets: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"148.153.72.214:20406"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"148.153.72.214:20407"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"148.153.72.214:20408"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"148.153.72.214:20409"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"148.153.72.214:20410"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h2",{attrs:{id:"三、安装-node-exporter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、安装-node-exporter"}},[t._v("#")]),t._v(" 三、安装 node-exporter")]),t._v(" "),s("p",[t._v("编辑 "),s("code",[t._v("prometheus.yml")]),t._v(" 将node_exporter加上。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("  - job_name: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_exporter'")]),t._v("\n    static_configs:\n    - targets: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:14202"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("ul",[s("li",[t._v("安装并启动")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --net"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node-exporter "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -v "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/:/host:ro,rslave"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  prom/node-exporter "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --path.rootfs /host\n")])])]),s("ul",[s("li",[t._v("重启docker prometheus，让刚才修改的配置生效")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker restart prometheus\n")])])]),s("h2",{attrs:{id:"四、安装-grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、安装-grafana"}},[t._v("#")]),t._v(" 四、安装 Grafana")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14206")]),t._v(":3000 --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("grafana grafana/grafana\n")])])]),s("p",[t._v("在浏览器输入 ip:端口 显示 grafana 则表示安装成功")]),t._v(" "),s("h2",{attrs:{id:"五、安装alertmanager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、安装alertmanager"}},[t._v("#")]),t._v(" 五、安装AlertManager")]),t._v(" "),s("blockquote",[s("p",[t._v("注意")]),t._v(" "),s("p",[t._v("AlertManager 默认配置文件为"),s("code",[t._v("alertmanager.yml")]),t._v(",AlertManager容器内的配置文件为："),s("code",[t._v("/etc/alertmanager/alertmanager.yml")])])]),t._v(" "),s("ul",[s("li",[t._v("启动 AlertManager")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14207")]),t._v(":9093 --name alertmanager "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/alertmanager.yml:/etc/alertmanager/alertmanager.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/:/etc/alertmanager/config/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/alertmanager\n")])])]),s("ul",[s("li",[t._v("AlertManager 参考文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("global:\n  resolve_timeout: 5m\n  smtp_smarthost: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"smtp.qq.com:587"')]),t._v("\n  smtp_from: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx@qq.com"')]),t._v("\n  smtp_auth_username: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx@qq.com"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#邮箱专用授权码")]),t._v("\n  smtp_auth_password: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭TLS授权")]),t._v("\n  smtp_require_tls: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#自定义告警模板")]),t._v("\ntemplates:\n  - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/alertmanager/config/alert-temp/*.tmpl"')]),t._v("\n\nroute:\n  group_by: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'swarm_status'")]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_status'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  group_wait: 30s\n  group_interval: 20m\n  repeat_interval: 1h\n  receiver: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'swarm_receiver'")]),t._v("\nreceivers:\n- name: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'swarm_receiver'")]),t._v("\n  email_configs:\n    - to: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx@qq.com'")]),t._v("\n      send_resolved: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ninhibit_rules:\n  - source_match:\n      severity: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'critical'")]),t._v("\n    target_match:\n      severity: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'warning'")]),t._v("\n    equal: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alertname'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dev'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'instance'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("ul",[s("li",[t._v("重新配置 Prometheus")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("alerting:\n  alertmanagers:\n  - static_configs:\n    - targets: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'172.31.10.69:14207'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("ul",[s("li",[t._v("配置说明：")])]),t._v(" "),s("p",[t._v("告诉prometheus，放生告警时，将告警信息发送到Alertmanager，Alertmanager地址为 http://172.31.10.69:14207")]),t._v(" "),s("ul",[s("li",[t._v("删除Prometheus之前容器，重新运行")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("先用"),s("code",[t._v("docker ps")]),t._v("查看prometheus容器ID")])]),t._v(" "),s("li",[s("p",[t._v("停掉容器 "),s("code",[t._v("docker stop ***")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker stop prometheus\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("删掉这个容器 "),s("code",[t._v("docker rm ***")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" prometheus\n")])])]),s("ul",[s("li",[t._v("重新启动容器")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14204")]),t._v(":9090 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/zhangZhang.yml:/etc/prometheus/zhangZhang.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/mhxw_node_exporter.yml:/etc/prometheus/mhxw_node_exporter.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/laoCui.yml:/etc/prometheus/laoCui.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/rules/alert-rules-node.yml:/etc/prometheus/rules/alert-rules-node.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/rules/alert-rules-mhxw.yml:/etc/prometheus/rules/alert-rules-mhxw.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/prometheus\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14204")]),t._v(":9090 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/:/etc/prometheus/config/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/prometheus\n")])])]),s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("https://cloud.tencent.com/developer/article/1486483\n")])])]),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("bee_export")])]),t._v(" "),s("li",[s("p",[t._v("prometheus")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20603")]),t._v(":9090 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/monitor/prometheus/:/etc/prometheus/config/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/prometheus\n\ndocker logs -f prometheus\n\ndocker stop prometheus\n\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" prometheus\n")])])]),s("ul",[s("li",[t._v("alertmanager")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20604")]),t._v(":9093 --name alertmanager "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/prometheus/alertmanager.yml:/etc/alertmanager/alertmanager.yml "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-v /mhxw/prometheus/:/etc/alertmanager/config/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nprom/alertmanager\n\ndocker stop alertmanager\n\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" alertmanager\n")])])]),s("ul",[s("li",[t._v("bee_export")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --restart unless-stopped "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20601")]),t._v(":20601 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t--name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bee_export "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t--log-opt max-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("20m "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t--log-opt max-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t-v /mhxw/monitor/bee_export/info.json:/usr/local/bin/info.json "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\tsgswarm/bee_export:0.0.6 -path /usr/local/bin/info.json\n\ndocker stop bee_export\n\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" bee_export\n")])])]),s("h2",{attrs:{id:"常见错误处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见错误处理"}},[t._v("#")]),t._v(" 常见错误处理")]),t._v(" "),s("ul",[s("li",[t._v("问题一")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("error "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ts")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-06-25T02:55:06.818Z "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("caller")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("query_logger.go:87 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("component")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("activeQueryTracker "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("msg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Error opening query log file"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/prometheus/queries.active "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("err")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"open /prometheus/queries.active: permission denied"')]),t._v("\npanic: Unable to create mmap-ed active query log\n\ngoroutine "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("running"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\ngithub.com/prometheus/prometheus/promql.NewActiveQueryTracker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x7ffde0177f57, 0xb, 0x14, 0x375eea0, 0xc000092c80, 0x375eea0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        /app/promql/query_logger.go:117 +0x4e8\nmain.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        /app/cmd/prometheus/main.go:462 +0x5990\n")])])]),s("p",[t._v("启动命令造成")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("-v /mhxw/monitor/prometheus/data:/prometheus "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n")])])]),s("ul",[s("li",[t._v("问题二")])]),t._v(" "),s("p",[t._v("docker启动时候，prometheus命令放在镜像名后面")])])}),[],!1,null,null,null);e.default=r.exports}}]);